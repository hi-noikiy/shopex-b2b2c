source sysitem_item
{
    {sourcesConfig}

    sql_query_pre = SET NAMES utf8
    sql_query = SELECT a.item_id,    a.is_selfshop,   a.shop_id,       a.cat_id,     a.brand_id, \
                       a.dlytmpl_id, a.use_platform,  a.shop_cat_id,   a.title,      a.sub_title, \
                       a.bn,         a.price,         a.modified_time, \
                       b.item_id,    b.sold_quantity, b.rate_count,    b.view_count, b.buy_count, \
                       c.item_id,    c.default_weight \
                FROM      sysitem_item as a \
                LEFT JOIN sysitem_item_count as b \
                ON        a.item_id = b.item_id \
                LEFT JOIN sysitem_item_search_weight as c \
                ON        a.item_id = c.item_id

    sql_attr_uint = item_id
    sql_attr_uint = is_selfshop
    sql_attr_uint = use_platform
    sql_attr_uint = modified_time
    sql_attr_uint = sold_quantity
    sql_attr_uint = rate_count
    sql_attr_uint = view_count
    sql_attr_uint = buy_count
    sql_attr_uint = default_weight

    sql_joined_field = brand_name from query;SELECT g.item_id,CONCAT(b.brand_name,b.brand_alias) FROM syscategory_brand as b LEFT JOIN sysitem_item as g ON g.brand_id=b.brand_id order by g.item_id asc

    sql_joined_field = shop_name from query;SELECT g.item_id,CONCAT(s.shop_name,s.shop_id) FROM sysshop_shop as s LEFT JOIN sysitem_item as g ON g.shop_id=s.shop_id order by g.item_id asc

    sql_joined_field = search_keyworeds from query;SELECT item_id,CONCAT(title,item_id) FROM sysitem_item  order by item_id asc

    sql_joined_field  = prop_index from query;SELECT item_id,CONCAT(prop_id,'_',prop_value_id) FROM sysitem_item_nature_props

    sql_joined_field  = approve_status from query;SELECT item_id,approve_status FROM sysitem_item_status

    #商品上下架时间
    sql_attr_multi  = uint list_time from query;SELECT item_id,list_time FROM sysitem_item_status
    sql_attr_multi  = uint delist_time from query;SELECT item_id,delist_time FROM sysitem_item_status

    #商品库存
    sql_attr_multi  = uint store from query;SELECT item_id,store FROM sysitem_item_store
    sql_attr_multi  = uint freez from query;SELECT item_id,freez FROM sysitem_item_store

    #属性值
    sql_attr_multi  = uint prop_value_id from query;SELECT item_id,prop_value_id FROM sysitem_item_nature_props

    sql_attr_uint = shop_id
    sql_attr_uint = dlytmpl_id
    sql_attr_uint = brand_id
    sql_attr_uint = cat_id
    sql_attr_float = price
}

index  sysitem_item_merge
{
    source          = sysitem_item
    path            = /usr/local/var/data/sysitem_item_new
    docinfo         = extern
    morphology = none
    charset_table   = U+FF10..U+FF19->0..9, 0..9, U+FF41..U+FF5A->a..z, U+FF21..U+FF3A->a..z,A..Z->a..z, a..z, U+0149, U+017F, U+0138, U+00DF, U+00FF, U+00C0..U+00D6->U+00E0..U+00F6,U+00E0..U+00F6, U+00D8..U+00DE->U+00F8..U+00FE, U+00F8..U+00FE, U+0100->U+0101, U+0101,U+0102->U+0103, U+0103, U+0104->U+0105, U+0105, U+0106->U+0107, U+0107, U+0108->U+0109,U+0109, U+010A->U+010B, U+010B, U+010C->U+010D, U+010D, U+010E->U+010F, U+010F,U+0110->U+0111, U+0111, U+0112->U+0113, U+0113, U+0114->U+0115, U+0115, U+0116->U+0117,U+0117, U+0118->U+0119, U+0119, U+011A->U+011B, U+011B, U+011C->U+011D, U+011D,U+011E->U+011F, U+011F, U+0130->U+0131, U+0131, U+0132->U+0133, U+0133, U+0134->U+0135,U+0135, U+0136->U+0137, U+0137, U+0139->U+013A, U+013A, U+013B->U+013C, U+013C,U+013D->U+013E, U+013E, U+013F->U+0140, U+0140, U+0141->U+0142, U+0142, U+0143->U+0144,U+0144, U+0145->U+0146, U+0146, U+0147->U+0148, U+0148, U+014A->U+014B, U+014B,U+014C->U+014D, U+014D, U+014E->U+014F, U+014F, U+0150->U+0151, U+0151, U+0152->U+0153,U+0153, U+0154->U+0155, U+0155, U+0156->U+0157, U+0157, U+0158->U+0159, U+0159,U+015A->U+015B, U+015B, U+015C->U+015D, U+015D, U+015E->U+015F, U+015F, U+0160->U+0161,U+0161, U+0162->U+0163, U+0163, U+0164->U+0165, U+0165, U+0166->U+0167, U+0167,U+0168->U+0169, U+0169, U+016A->U+016B, U+016B, U+016C->U+016D, U+016D, U+016E->U+016F,U+016F, U+0170->U+0171, U+0171, U+0172->U+0173, U+0173, U+0174->U+0175, U+0175,U+0176->U+0177, U+0177, U+0178->U+00FF, U+00FF, U+0179->U+017A, U+017A, U+017B->U+017C,U+017C, U+017D->U+017E, U+017E, U+0410..U+042F->U+0430..U+044F, U+0430..U+044F,U+05D0..U+05EA, U+0531..U+0556->U+0561..U+0586, U+0561..U+0587, U+0621..U+063A, U+01B9,U+01BF, U+0640..U+064A, U+0660..U+0669, U+066E, U+066F, U+0671..U+06D3, U+06F0..U+06FF,U+0904..U+0939, U+0958..U+095F, U+0960..U+0963, U+0966..U+096F, U+097B..U+097F,U+0985..U+09B9, U+09CE, U+09DC..U+09E3, U+09E6..U+09EF, U+0A05..U+0A39, U+0A59..U+0A5E,U+0A66..U+0A6F, U+0A85..U+0AB9, U+0AE0..U+0AE3, U+0AE6..U+0AEF, U+0B05..U+0B39,U+0B5C..U+0B61, U+0B66..U+0B6F, U+0B71, U+0B85..U+0BB9, U+0BE6..U+0BF2, U+0C05..U+0C39,U+0C66..U+0C6F, U+0C85..U+0CB9, U+0CDE..U+0CE3, U+0CE6..U+0CEF, U+0D05..U+0D39, U+0D60,U+0D61, U+0D66..U+0D6F, U+0D85..U+0DC6, U+1900..U+1938, U+1946..U+194F, U+A800..U+A805,U+A807..U+A822, U+0386->U+03B1, U+03AC->U+03B1, U+0388->U+03B5, U+03AD->U+03B5,U+0389->U+03B7, U+03AE->U+03B7, U+038A->U+03B9, U+0390->U+03B9, U+03AA->U+03B9,U+03AF->U+03B9, U+03CA->U+03B9, U+038C->U+03BF, U+03CC->U+03BF, U+038E->U+03C5,U+03AB->U+03C5, U+03B0->U+03C5, U+03CB->U+03C5, U+03CD->U+03C5, U+038F->U+03C9,U+03CE->U+03C9, U+03C2->U+03C3, U+0391..U+03A1->U+03B1..U+03C1,U+03A3..U+03A9->U+03C3..U+03C9, U+03B1..U+03C1, U+03C3..U+03C9, U+0E01..U+0E2E,U+0E30..U+0E3A, U+0E40..U+0E45, U+0E47, U+0E50..U+0E59, U+A000..U+A48F, U+4E00..U+9FBF,U+3400..U+4DBF, U+20000..U+2A6DF, U+F900..U+FAFF, U+2F800..U+2FA1F, U+2E80..U+2EFF,U+2F00..U+2FDF, U+3100..U+312F, U+31A0..U+31BF, U+3040..U+309F, U+30A0..U+30FF,U+31F0..U+31FF, U+AC00..U+D7AF, U+1100..U+11FF, U+3130..U+318F, U+A000..U+A48F,U+A490..U+A4CF
    min_infix_len   = 1
    min_prefix_len  = 0;

    #可以多个配置
    #regexp_filter = (phone|shouji|手机|sj) => 手机
    #单词+数字索引
    #需要re2的正则引擎替代系统内置的正则引擎，安装好后重新编译安装sphinx的源码，在./configure的时候带上参数--with-re2
    #regexp_filter　= (［a-z|A-Z］+)(\d+) =>\1 \2

    ngram_len = 1
    #ngram_chars     = U+4E00..U+9FBF, U+3400..U+4DBF, U+20000..U+2A6DF, U+F900..U+FAFF,U+2F800..U+2FA1F, U+2E80..U+2EFF, U+2F00..U+2FDF, U+3100..U+312F, U+31A0..U+31BF,U+3040..U+309F, U+30A0..U+30FF, U+31F0..U+31FF, U+AC00..U+D7AF, U+1100..U+11FF,U+3130..U+318F, U+A000..U+A48F, U+A490..U+A4CF
    ngram_chars = U+4E00..U+9FBB, U+3400..U+4DB5, U+20000..U+2A6D6, U+FA0E, U+FA0F, U+FA11, U+FA13, U+FA14, U+FA1F, U+FA21, U+FA23, U+FA24, U+FA27, U+FA28, U+FA29, U+3105..U+312C, U+31A0..U+31B7, U+3041, U+3043, U+3045, U+3047, U+3049, U+304B, U+304D, U+304F, U+3051, U+3053, U+3055, U+3057, U+3059, U+305B, U+305D, U+305F, U+3061, U+3063, U+3066, U+3068, U+306A..U+306F, U+3072, U+3075, U+3078, U+307B, U+307E..U+3083, U+3085, U+3087, U+3089..U+308E, U+3090..U+3093, U+30A1, U+30A3, U+30A5, U+30A7, U+30A9, U+30AD, U+30AF, U+30B3, U+30B5, U+30BB, U+30BD, U+30BF, U+30C1, U+30C3, U+30C4, U+30C6, U+30CA, U+30CB, U+30CD, U+30CE, U+30DE, U+30DF, U+30E1, U+30E2, U+30E3, U+30E5, U+30E7, U+30EE, U+30F0..U+30F3, U+30F5, U+30F6, U+31F0, U+31F1, U+31F2, U+31F3, U+31F4, U+31F5, U+31F6, U+31F7, U+31F8, U+31F9, U+31FA, U+31FB, U+31FC, U+31FD, U+31FE, U+31FF, U+AC00..U+D7A3, U+1100..U+1159, U+1161..U+11A2, U+11A8..U+11F9, U+A000..U+A48C, U+A492..U+A4C6
    html_strip = 1
}

source sysitem_item_delta:sysitem_item
{
    {sourcesConfig}

    sql_query_pre       = SET NAMES utf8
   


    sql_query = SELECT b.item_id,    b.is_selfshop,   b.shop_id,       b.cat_id,     b.brand_id, \
                       b.dlytmpl_id, b.use_platform,  b.shop_cat_id,   b.title,      b.sub_title, \
                       b.bn,         b.price,         b.modified_time, \
                       c.item_id,    c.sold_quantity, c.rate_count,    c.view_count, c.buy_count, \
                       d.item_id,    d.default_weight \
                FROM      search_delta as a \
                LEFT JOIN sysitem_item as b \
                ON        a.id = b.item_id \
                LEFT JOIN sysitem_item_count as c \
                ON        b.item_id = c.item_id \
                LEFT JOIN sysitem_item_search_weight as d \
                ON        b.item_id = d.item_id \
                WHERE     index_name='sysitem_item'


    sql_attr_uint = item_id
    sql_attr_uint = is_selfshop
    sql_attr_uint = use_platform
    sql_attr_uint = modified_time
    sql_attr_uint = sold_quantity
    sql_attr_uint = rate_count
    sql_attr_uint = view_count
    sql_attr_uint = buy_count
    sql_attr_uint = default_weight

    sql_joined_field = brand_name from query;SELECT g.item_id,CONCAT(b.brand_name,b.brand_alias) from search_delta as d left join sysitem_item as g on d.id=g.item_id left join syscategory_brand as b on g.brand_id=b.brand_id where index_name='sysitem_item' and last_modify>unix_timestamp()-86400 order by g.item_id asc
    sql_joined_field = shop_name from query;SELECT g.item_id,CONCAT(s.shop_name,s.shop_id) from search_delta as d left join sysitem_item as g on d.id=g.item_id left join sysshop_shop as s on g.shop_id=s.shop_id  where index_name='sysitem_item' and last_modify>unix_timestamp()-86400 order by g.item_id asc
    sql_joined_field = search_keyworeds from query;SELECT item_id,CONCAT(title,item_id) from search_delta as d left join sysitem_item as g on d.id=g.item_id where index_name='sysitem_item' and last_modify>unix_timestamp()-86400 order by item_id asc
    sql_joined_field  = prop_index from query;select item_id,CONCAT(prop_id,'_',prop_value_id) from search_delta as d left join sysitem_item_nature_props as p on d.id=p.item_id where index_name='sysitem_item' and last_modify>unix_timestamp()-86400 order by item_id asc


    sql_joined_field  = approve_status from query;select item_id,approve_status from search_delta as d left join sysitem_item_status as s on d.id=s.item_id where index_name='sysitem_item' and last_modify>unix_timestamp()-86400 order by item_id asc

    #商品上下架时间
    sql_attr_multi  = uint list_time from query;select item_id,list_time from search_delta as d left join sysitem_item_status as s on d.id=s.item_id where index_name='sysitem_item' and last_modify>unix_timestamp()-86400
    sql_attr_multi  = uint delist_time from query;select item_id,delist_time from search_delta as d left join sysitem_item_status as s on d.id=s.item_id where index_name='sysitem_item' and last_modify>unix_timestamp()-86400

    #商品库存
    sql_attr_multi  = uint store from query;select item_id,store from search_delta as d left join sysitem_item_store as s on d.id=s.item_id where index_name='sysitem_item' and last_modify>unix_timestamp()-86400
    sql_attr_multi  = uint freez from query;select item_id,freez from search_delta as d left join sysitem_item_store as s on d.id=s.item_id where index_name='sysitem_item' and last_modify>unix_timestamp()-86400
    sql_attr_multi  = uint prop_value_id from query;select item_id,prop_value_id from search_delta as d left join sysitem_item_nature_props as p on d.id=p.item_id where index_name='sysitem_item' and last_modify>unix_timestamp()-86400

    sql_attr_uint = shop_id
    sql_attr_uint = dlytmpl_id
    sql_attr_uint = brand_id
    sql_attr_uint = cat_id
    sql_attr_float = price
}

index  sysitem_item_delta
{
    source          = sysitem_item_delta
    path            = /usr/local/var/data/sysitem_item_delta_new
    docinfo         = extern
    morphology = none
    charset_table   = U+FF10..U+FF19->0..9, 0..9, U+FF41..U+FF5A->a..z, U+FF21..U+FF3A->a..z,A..Z->a..z, a..z, U+0149, U+017F, U+0138, U+00DF, U+00FF, U+00C0..U+00D6->U+00E0..U+00F6,U+00E0..U+00F6, U+00D8..U+00DE->U+00F8..U+00FE, U+00F8..U+00FE, U+0100->U+0101, U+0101,U+0102->U+0103, U+0103, U+0104->U+0105, U+0105, U+0106->U+0107, U+0107, U+0108->U+0109,U+0109, U+010A->U+010B, U+010B, U+010C->U+010D, U+010D, U+010E->U+010F, U+010F,U+0110->U+0111, U+0111, U+0112->U+0113, U+0113, U+0114->U+0115, U+0115, U+0116->U+0117,U+0117, U+0118->U+0119, U+0119, U+011A->U+011B, U+011B, U+011C->U+011D, U+011D,U+011E->U+011F, U+011F, U+0130->U+0131, U+0131, U+0132->U+0133, U+0133, U+0134->U+0135,U+0135, U+0136->U+0137, U+0137, U+0139->U+013A, U+013A, U+013B->U+013C, U+013C,U+013D->U+013E, U+013E, U+013F->U+0140, U+0140, U+0141->U+0142, U+0142, U+0143->U+0144,U+0144, U+0145->U+0146, U+0146, U+0147->U+0148, U+0148, U+014A->U+014B, U+014B,U+014C->U+014D, U+014D, U+014E->U+014F, U+014F, U+0150->U+0151, U+0151, U+0152->U+0153,U+0153, U+0154->U+0155, U+0155, U+0156->U+0157, U+0157, U+0158->U+0159, U+0159,U+015A->U+015B, U+015B, U+015C->U+015D, U+015D, U+015E->U+015F, U+015F, U+0160->U+0161,U+0161, U+0162->U+0163, U+0163, U+0164->U+0165, U+0165, U+0166->U+0167, U+0167,U+0168->U+0169, U+0169, U+016A->U+016B, U+016B, U+016C->U+016D, U+016D, U+016E->U+016F,U+016F, U+0170->U+0171, U+0171, U+0172->U+0173, U+0173, U+0174->U+0175, U+0175,U+0176->U+0177, U+0177, U+0178->U+00FF, U+00FF, U+0179->U+017A, U+017A, U+017B->U+017C,U+017C, U+017D->U+017E, U+017E, U+0410..U+042F->U+0430..U+044F, U+0430..U+044F,U+05D0..U+05EA, U+0531..U+0556->U+0561..U+0586, U+0561..U+0587, U+0621..U+063A, U+01B9,U+01BF, U+0640..U+064A, U+0660..U+0669, U+066E, U+066F, U+0671..U+06D3, U+06F0..U+06FF,U+0904..U+0939, U+0958..U+095F, U+0960..U+0963, U+0966..U+096F, U+097B..U+097F,U+0985..U+09B9, U+09CE, U+09DC..U+09E3, U+09E6..U+09EF, U+0A05..U+0A39, U+0A59..U+0A5E,U+0A66..U+0A6F, U+0A85..U+0AB9, U+0AE0..U+0AE3, U+0AE6..U+0AEF, U+0B05..U+0B39,U+0B5C..U+0B61, U+0B66..U+0B6F, U+0B71, U+0B85..U+0BB9, U+0BE6..U+0BF2, U+0C05..U+0C39,U+0C66..U+0C6F, U+0C85..U+0CB9, U+0CDE..U+0CE3, U+0CE6..U+0CEF, U+0D05..U+0D39, U+0D60,U+0D61, U+0D66..U+0D6F, U+0D85..U+0DC6, U+1900..U+1938, U+1946..U+194F, U+A800..U+A805,U+A807..U+A822, U+0386->U+03B1, U+03AC->U+03B1, U+0388->U+03B5, U+03AD->U+03B5,U+0389->U+03B7, U+03AE->U+03B7, U+038A->U+03B9, U+0390->U+03B9, U+03AA->U+03B9,U+03AF->U+03B9, U+03CA->U+03B9, U+038C->U+03BF, U+03CC->U+03BF, U+038E->U+03C5,U+03AB->U+03C5, U+03B0->U+03C5, U+03CB->U+03C5, U+03CD->U+03C5, U+038F->U+03C9,U+03CE->U+03C9, U+03C2->U+03C3, U+0391..U+03A1->U+03B1..U+03C1,U+03A3..U+03A9->U+03C3..U+03C9, U+03B1..U+03C1, U+03C3..U+03C9, U+0E01..U+0E2E,U+0E30..U+0E3A, U+0E40..U+0E45, U+0E47, U+0E50..U+0E59, U+A000..U+A48F, U+4E00..U+9FBF,U+3400..U+4DBF, U+20000..U+2A6DF, U+F900..U+FAFF, U+2F800..U+2FA1F, U+2E80..U+2EFF,U+2F00..U+2FDF, U+3100..U+312F, U+31A0..U+31BF, U+3040..U+309F, U+30A0..U+30FF,U+31F0..U+31FF, U+AC00..U+D7AF, U+1100..U+11FF, U+3130..U+318F, U+A000..U+A48F,U+A490..U+A4CF
    min_infix_len   = 1
    min_prefix_len  = 0;

    #可以多个配置
    #regexp_filter = (phone|shouji|手机|sj) => 手机
    #单词+数字索引
    #需要re2的正则引擎替代系统内置的正则引擎，安装好后重新编译安装sphinx的源码，在./configure的时候带上参数--with-re2
    #regexp_filter　= (［a-z|A-Z］+)(\d+) =>\1 \2

    ngram_len = 1
    #ngram_chars     = U+4E00..U+9FBF, U+3400..U+4DBF, U+20000..U+2A6DF, U+F900..U+FAFF,U+2F800..U+2FA1F, U+2E80..U+2EFF, U+2F00..U+2FDF, U+3100..U+312F, U+31A0..U+31BF,U+3040..U+309F, U+30A0..U+30FF, U+31F0..U+31FF, U+AC00..U+D7AF, U+1100..U+11FF,U+3130..U+318F, U+A000..U+A48F, U+A490..U+A4CF
    ngram_chars = U+4E00..U+9FBB, U+3400..U+4DB5, U+20000..U+2A6D6, U+FA0E, U+FA0F, U+FA11, U+FA13, U+FA14, U+FA1F, U+FA21, U+FA23, U+FA24, U+FA27, U+FA28, U+FA29, U+3105..U+312C, U+31A0..U+31B7, U+3041, U+3043, U+3045, U+3047, U+3049, U+304B, U+304D, U+304F, U+3051, U+3053, U+3055, U+3057, U+3059, U+305B, U+305D, U+305F, U+3061, U+3063, U+3066, U+3068, U+306A..U+306F, U+3072, U+3075, U+3078, U+307B, U+307E..U+3083, U+3085, U+3087, U+3089..U+308E, U+3090..U+3093, U+30A1, U+30A3, U+30A5, U+30A7, U+30A9, U+30AD, U+30AF, U+30B3, U+30B5, U+30BB, U+30BD, U+30BF, U+30C1, U+30C3, U+30C4, U+30C6, U+30CA, U+30CB, U+30CD, U+30CE, U+30DE, U+30DF, U+30E1, U+30E2, U+30E3, U+30E5, U+30E7, U+30EE, U+30F0..U+30F3, U+30F5, U+30F6, U+31F0, U+31F1, U+31F2, U+31F3, U+31F4, U+31F5, U+31F6, U+31F7, U+31F8, U+31F9, U+31FA, U+31FB, U+31FC, U+31FD, U+31FE, U+31FF, U+AC00..U+D7A3, U+1100..U+1159, U+1161..U+11A2, U+11A8..U+11F9, U+A000..U+A48C, U+A492..U+A4C6
    html_strip      = 1
}

index sysitem_item
{
    type =  distributed
    local = sysitem_item_delta
    local = sysitem_item_merge
}
