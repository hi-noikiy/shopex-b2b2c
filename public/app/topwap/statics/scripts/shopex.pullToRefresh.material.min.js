!function(t){var n=t.className("pull-top-tips");t.PullToRefresh=t.PullToRefresh.extend({init:function(n,i){this._super(n,i),this.options=t.extend(!0,{down:{tips:{colors:["008000","d8ad44","d00324","dc00b8","017efc"],size:200,lineWidth:15,duration:1e3,tail_duration:2500}}},this.options),this.options.down.tips.color=this.options.down.tips.colors[0],this.options.down.tips.colors=this.options.down.tips.colors.map(function(t){return{r:parseInt(t.substring(0,2),16),g:parseInt(t.substring(2,4),16),b:parseInt(t.substring(4,6),16)}})},initPullDownTips:function(){var i=this;t.isFunction(i.options.down.callback)&&(i.pullDownTips=function(){var t=document.querySelector("."+n);return t&&t.parentNode.removeChild(t),t||(t=document.createElement("div"),t.classList.add(n),t.innerHTML='<div class="shopex-pull-top-wrapper"><div class="shopex-pull-top-canvas"><canvas id="pullDownTips" width="'+i.options.down.tips.size+'" height="'+i.options.down.tips.size+'"></canvas></div></div>',t.addEventListener("webkitTransitionEnd",i),document.body.appendChild(t)),i.pullDownCanvas=document.getElementById("pullDownTips"),i.pullDownCanvasCtx=i.pullDownCanvas.getContext("2d"),i.canvasUtils.init(i.pullDownCanvas,i.options.down.tips),t}())},removePullDownTips:function(){this._super(),this.canvasUtils.stopSpin()},pulling:function(t){var n=Math.min(t/(1.5*this.options.down.height),1),i=Math.min(1,2*n);this.pullDownTips.style.webkitTransform="translate3d(0,"+(t<0?0:t)+"px,0)",this.pullDownCanvas.style.opacity=i,this.pullDownCanvas.style.webkitTransform="rotate("+300*n+"deg)";var s=this.pullDownCanvas,e=this.pullDownCanvasCtx,o=this.options.down.tips.size;e.lineWidth=this.options.down.tips.lineWidth,e.fillStyle="#"+this.options.down.tips.color,e.strokeStyle="#"+this.options.down.tips.color,e.stroke(),e.clearRect(0,0,o,o),s.style.display="none",s.offsetHeight,s.style.display="inherit",this.canvasUtils.drawArcedArrow(e,o/2+.5,o/2,o/4,0*Math.PI,5/3*Math.PI*i,!1,1,2,.7853981633974483,25,this.options.down.tips.lineWidth,this.options.down.tips.lineWidth)},beforeChangeOffset:function(t){},afterChangeOffset:function(t){},dragEndAfterChangeOffset:function(t){t?(this.canvasUtils.startSpin(),this.pullDownLoading()):(this.canvasUtils.stopSpin(),this.endPullDownToRefresh())},canvasUtils:function(){function n(t,n,i,s){return i*t/s+n}function i(t,n,i,s){return(t/=s/2)<1?i/2*t*t+n:-i/2*(--t*(t-2)-1)+n}function s(t,n,i){var s=Math.min(n,i),e=Math.max(n,i);return t<s?s:t>e?s:t}var e=null,o=null,a=200,r=15,p=0,l=0,h=0,d=0,c=0,u=180,f=Math.PI/180,v=1e3,M=2500,w=["35ad0e","d8ad44","d00324","dc00b8","017efc"],g=null,y=function(t,n,i,s,e,o,a,r){"use strict";"string"==typeof n&&(n=parseInt(n)),"string"==typeof i&&(i=parseInt(i)),"string"==typeof s&&(s=parseInt(s)),"string"==typeof e&&(e=parseInt(e)),"string"==typeof o&&(o=parseInt(o)),"string"==typeof a&&(a=parseInt(a));2*Math.PI;switch(t.save(),t.beginPath(),t.moveTo(n,i),t.lineTo(s,e),t.lineTo(o,a),r){case 0:var p=Math.sqrt((o-n)*(o-n)+(a-i)*(a-i));t.arcTo(s,e,n,i,.55*p),t.fill();break;case 1:t.beginPath(),t.moveTo(n,i),t.lineTo(s,e),t.lineTo(o,a),t.lineTo(n,i),t.fill();break;case 2:t.stroke();break;case 3:var l=(n+s+o)/3,h=(i+e+a)/3;t.quadraticCurveTo(l,h,n,i),t.fill();break;case 4:var d,c,u,f,p,v=5;if(o==n)p=a-i,d=(s+n)/2,u=(s+n)/2,c=e+p/v,f=e-p/v;else{p=Math.sqrt((o-n)*(o-n)+(a-i)*(a-i));var M=(n+o)/2,w=(i+a)/2,g=(M+s)/2,y=(w+e)/2,b=(a-i)/(o-n),I=p/(2*Math.sqrt(b*b+1))/v,m=b*I;d=g-I,c=y-m,u=g+I,f=y+m}t.bezierCurveTo(d,c,u,f,n,i),t.fill()}t.restore()},b=function(t,n,i,s,e,o,a,r,p,l,h,d,c){"use strict";r="undefined"!=typeof r?r:3,p="undefined"!=typeof p?p:1,l="undefined"!=typeof l?l:Math.PI/8,d=d||1,c=c||10,h="undefined"!=typeof h?h:10,t.save(),t.lineWidth=d,t.beginPath(),t.arc(n,i,s,e,o,a),t.stroke();var u,f,v,M,w;1&p&&(u=Math.cos(e)*s+n,f=Math.sin(e)*s+i,v=Math.atan2(n-u,f-i),a?(M=u+10*Math.cos(v),w=f+10*Math.sin(v)):(M=u-10*Math.cos(v),w=f-10*Math.sin(v)),I(t,u,f,M,w,r,2,l,h)),2&p&&(u=Math.cos(o)*s+n,f=Math.sin(o)*s+i,v=Math.atan2(n-u,f-i),a?(M=u-10*Math.cos(v),w=f-10*Math.sin(v)):(M=u+10*Math.cos(v),w=f+10*Math.sin(v)),I(t,u-c*Math.sin(o),f+c*Math.cos(o),M-c*Math.sin(o),w+c*Math.cos(o),r,2,l,h)),t.restore()},I=function(t,n,i,s,e,o,a,r,p){"use strict";"string"==typeof n&&(n=parseInt(n)),"string"==typeof i&&(i=parseInt(i)),"string"==typeof s&&(s=parseInt(s)),"string"==typeof e&&(e=parseInt(e)),o="undefined"!=typeof o?o:3,a="undefined"!=typeof a?a:1,r="undefined"!=typeof r?r:Math.PI/8,p="undefined"!=typeof p?p:10;var l,h,d,c,u="function"!=typeof o?y:o,f=Math.sqrt((s-n)*(s-n)+(e-i)*(e-i)),v=(f-p/3)/f;1&a?(l=Math.round(n+(s-n)*v),h=Math.round(i+(e-i)*v)):(l=s,h=e),2&a?(d=n+(s-n)*(1-v),c=i+(e-i)*(1-v)):(d=n,c=i),t.beginPath(),t.moveTo(d,c),t.lineTo(l,h),t.stroke();var M=Math.atan2(e-i,s-n),w=Math.abs(p/Math.cos(r));if(1&a){var g=M+Math.PI+r,b=s+Math.cos(g)*w,I=e+Math.sin(g)*w,m=M+Math.PI-r,T=s+Math.cos(m)*w,C=e+Math.sin(m)*w;u(t,b,I,s,e,T,C,o)}if(2&a){var g=M+r,b=n+Math.cos(g)*w,I=i+Math.sin(g)*w,m=M-r,T=n+Math.cos(m)*w,C=i+Math.sin(m)*w;u(t,b,I,n,i,T,C,o)}},m=function(t,i){var e=t%i;e<h&&w.push(w.shift());var o=w[0],a=w[1],r=s(n(e,o.r,a.r-o.r,i),o.r,a.r),p=s(n(e,o.g,a.g-o.g,i),o.g,a.g),l=s(n(e,o.b,a.b-o.b,i),o.b,a.b);return h=e,"rgb("+parseInt(r)+","+parseInt(p)+","+parseInt(l)+")"},T=function(t){var s=t||(new Date).getTime();l||(l=s),p=s-l,d=i((p+M/2)%M,0,v,M),c=n((p+d)%v,0,360,v),u=20+Math.abs(n((p+M/2)%M,-300,600,M)),o.lineWidth=r,o.lineCap="round",o.strokeStyle=m(p,v),o.clearRect(0,0,a,a),e.style.display="none",e.offsetHeight,e.style.display="inherit",o.beginPath(),o.arc(a/2,a/2,a/4,parseInt(c-u)%360*f,parseInt(c)%360*f,!1),o.stroke(),g=requestAnimationFrame(T)},C=function(){l=0,h=0,g=requestAnimationFrame(T)},P=function(){g&&cancelAnimationFrame(g)},D=function(n,i){e=n,o=e.getContext("2d");var i=t.extend(!0,{},i);w=i.colors,v=i.duration,M=i.tail_duration,a=i.size,r=i.lineWidth};return{init:D,drawArcedArrow:b,startSpin:C,stopSpin:P}}()})}(shopex);