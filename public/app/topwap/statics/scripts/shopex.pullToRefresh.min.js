!function(t,e,i){var s="beforeChangeOffset",n="afterChangeOffset",l="pullstart",o="pulling",a=s,r=n,p="dragEndAfterChangeOffset",h=t.className("transitioning"),u=t.className("pull-top-tips"),d=t.className("pull-bottom-tips"),c=t.className("pull-loading"),g=t.className("scroll"),f=t.className("pull-loading")+" "+t.className("icon")+" "+t.className("icon-pulldown"),m=f+" "+t.className("reverse"),T=t.className("pull-loading")+" "+t.className("spinner"),v=t.className("hidden"),w="."+c;t.PullToRefresh=t.Class.extend({init:function(e,i){this.element=e,this.options=t.extend(!0,{down:{height:75,callback:!1},up:{auto:!1,offset:100,show:!0,contentdown:"上拉显示更多",contentrefresh:"正在加载...",contentnomore:"没有更多数据了",callback:!1},preventDefaultException:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT)$/}},i),this.stopped=this.isNeedRefresh=this.isDragging=!1,this.state=s,this.isInScroll=this.element.classList.contains(g),this.initPullUpTips(),this.initEvent()},_preventDefaultException:function(t,e){for(var i in e)if(e[i].test(t[i]))return!0;return!1},initEvent:function(){t.isFunction(this.options.down.callback)&&(this.element.addEventListener(t.EVENT_START,this),this.element.addEventListener("drag",this),this.element.addEventListener("dragend",this)),this.pullUpTips&&(this.element.addEventListener("dragup",this),this.isInScroll?this.element.addEventListener("scrollbottom",this):e.addEventListener("scroll",this))},handleEvent:function(e){switch(e.type){case t.EVENT_START:this.isInScroll&&this._canPullDown()&&e.target&&!this._preventDefaultException(e.target,this.options.preventDefaultException)&&e.preventDefault();break;case"drag":this._drag(e);break;case"dragend":this._dragend(e);break;case"webkitTransitionEnd":this._transitionEnd(e);break;case"dragup":case"scroll":this._dragup(e);break;case"scrollbottom":this.pullUpLoading(e)}},initPullDownTips:function(){var e=this;t.isFunction(e.options.down.callback)&&(e.pullDownTips=function(){var t=i.querySelector("."+u);return t&&t.parentNode.removeChild(t),t||(t=i.createElement("div"),t.classList.add(u),t.innerHTML='<div class="shopex-pull-top-wrapper"><span class="shopex-pull-loading shopex-icon shopex-icon-pulldown"></span></div>',t.addEventListener("webkitTransitionEnd",e)),e.pullDownTipsIcon=t.querySelector(w),i.body.appendChild(t),t}())},initPullUpTips:function(){var e=this;t.isFunction(e.options.up.callback)&&(e.pullUpTips=function(){var t=e.element.querySelector("."+d);return t||(t=i.createElement("div"),t.classList.add(d),e.options.up.show||t.classList.add(v),t.innerHTML='<div class="shopex-pull-bottom-wrapper"><span class="shopex-pull-loading">'+e.options.up.contentdown+"</span></div>",e.element.appendChild(t)),e.pullUpTipsIcon=t.querySelector(w),t}())},_transitionEnd:function(t){t.target===this.pullDownTips&&this.removing&&this.removePullDownTips()},_dragup:function(e){var i=this;if(!i.loading){if(e&&e.detail&&t.gestures.session.drag)i.isDraggingUp=!0;else if(!i.isDraggingUp)return;i.isDragging||i._canPullUp()&&i.pullUpLoading(e)}},_canPullUp:function(){if(this.removing)return!1;if(this.isInScroll){var s=this.element.parentNode.getAttribute("data-scroll");if(s){var n=t.data[s];return n.y===n.maxScrollY}}return e.pageYOffset+e.innerHeight+this.options.up.offset>=i.documentElement.scrollHeight},_canPullDown:function(){if(this.removing)return!1;if(this.isInScroll){var e=this.element.parentNode.getAttribute("data-scroll");if(e){var s=t.data[e];return 0===s.y}}return 0===i.body.scrollTop},_drag:function(l){if(this.loading||this.stopped)return l.stopPropagation(),void l.detail.gesture.preventDefault();var o=l.detail;if(!this.isDragging&&"down"===o.direction&&this._canPullDown()){if(i.querySelector("."+u))return l.stopPropagation(),void l.detail.gesture.preventDefault();this.isDragging=!0,this.removing=!1,this.startDeltaY=o.deltaY,t.gestures.session.lockDirection=!0,t.gestures.session.startDirection=o.direction,this._pullStart(this.startDeltaY)}if(this.isDragging){l.stopPropagation(),l.detail.gesture.preventDefault();var a=o.deltaY-this.startDeltaY;a=Math.min(a,1.5*this.options.down.height),this.deltaY=a,this._pulling(a);var r=a>this.options.down.height?n:s;if(this.state!==r&&(this.state=r,this.state===n?(this.removing=!1,this.isNeedRefresh=!0):(this.removing=!0,this.isNeedRefresh=!1),this["_"+r](a)),t.os.ios&&parseFloat(t.os.version)>=8){var p=o.gesture.touches[0].clientY;if(p+10>e.innerHeight||p<10)return void this._dragend(l)}}},_dragend:function(t){var e=this;e.isDragging&&(e.isDragging=!1,e._dragEndAfterChangeOffset(e.isNeedRefresh)),e.isPullingUp&&(e.pullingUpTimeout&&clearTimeout(e.pullingUpTimeout),e.pullingUpTimeout=setTimeout(function(){e.isPullingUp=!1},1e3))},_pullStart:function(e){this.pullStart(e),t.trigger(this.element,l,{api:this,startDeltaY:e})},_pulling:function(e){this.pulling(e),t.trigger(this.element,o,{api:this,deltaY:e})},_beforeChangeOffset:function(e){this.beforeChangeOffset(e),t.trigger(this.element,a,{api:this,deltaY:e})},_afterChangeOffset:function(e){this.afterChangeOffset(e),t.trigger(this.element,r,{api:this,deltaY:e})},_dragEndAfterChangeOffset:function(e){this.dragEndAfterChangeOffset(e),t.trigger(this.element,p,{api:this,isNeedRefresh:e})},removePullDownTips:function(){if(this.pullDownTips)try{this.pullDownTips.parentNode&&this.pullDownTips.parentNode.removeChild(this.pullDownTips),this.pullDownTips=null,this.removing=!1}catch(t){}},pullStart:function(t){this.initPullDownTips(t)},pulling:function(t){this.pullDownTips.style.webkitTransform="translate3d(0,"+t+"px,0)"},beforeChangeOffset:function(t){this.pullDownTipsIcon.className=f},afterChangeOffset:function(t){this.pullDownTipsIcon.className=m},dragEndAfterChangeOffset:function(t){t?(this.pullDownTipsIcon.className=T,this.pullDownLoading()):(this.pullDownTipsIcon.className=f,this.endPullDownToRefresh())},pullDownLoading:function(){if(!this.loading){if(!this.pullDownTips)return this.initPullDownTips(),void this.dragEndAfterChangeOffset(!0);this.loading=!0,this.pullDownTips.classList.add(h),this.pullDownTips.style.webkitTransform="translate3d(0,"+this.options.down.height+"px,0)",this.options.down.callback.apply(this)}},pullUpLoading:function(t){this.loading||this.finished||(this.loading=!0,this.isDraggingUp=!1,this.pullUpTips.classList.remove(v),t&&t.detail&&t.detail.gesture&&t.detail.gesture.preventDefault(),this.pullUpTipsIcon.innerHTML=this.options.up.contentrefresh,this.options.up.callback.apply(this))},endPullDownToRefresh:function(){this.loading=!1,this.pullUpTips&&this.pullUpTips.classList.remove(v),this.pullDownTips.classList.add(h),this.pullDownTips.style.webkitTransform="translate3d(0,0,0)",this.deltaY<=0?this.removePullDownTips():this.removing=!0,this.isInScroll&&t(this.element.parentNode).scroll().refresh()},endPullUpToRefresh:function(i){i&&1==i?(this.finished=!0,this.pullUpTipsIcon.innerHTML=this.options.up.contentnomore,this.element.removeEventListener("dragup",this),e.removeEventListener("scroll",this)):i&&0==i&&(this.pullUpTipsIcon.innerHTML=this.options.up.contentdown),this.loading=!1,this.isInScroll&&t(this.element.parentNode).scroll().refresh()},setStopped:function(t){t!=this.stopped&&(this.stopped=t,this.pullUpTips&&this.pullUpTips.classList[t?"add":"remove"](v))},refresh:function(t){t&&this.finished&&this.pullUpTipsIcon&&(this.pullUpTipsIcon.innerHTML=this.options.up.contentdown,this.element.addEventListener("dragup",this),e.addEventListener("scroll",this),this.finished=!1)}}),t.fn.pullToRefresh=function(e){var i=[];return e=e||{},this.each(function(){var s=this,n=null,l=s.getAttribute("data-pullToRefresh");l?n=t.data[l]:(l=++t.uuid,t.data[l]=n=new t.PullToRefresh(s,e),s.setAttribute("data-pullToRefresh",l)),e.up&&e.up.auto&&n.pullUpLoading(),i.push(n)}),1===i.length?i[0]:i}}(shopex,window,document);